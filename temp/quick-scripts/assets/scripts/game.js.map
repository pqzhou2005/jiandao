{"version":3,"sources":["game.js"],"names":["cc","Class","extends","Component","properties","toplabel","default","type","Label","readybtn","Button","card_jiandao","Node","card_bu","card_shitou","jiandao","bu","shitou","countdown","onLoad","lastrandom","topready","bottomready","top_grid","x","y","name","bottom_grid","schedule","swap","scheduleOnce","string","node","emit","on","event","getChildByName","getComponent","msg","console","log","layout","amin","Animation","anim","play","EventType","TOUCH_MOVE","onTouchMove","TOUCH_END","onTouchEnd","start","delta","touch","getDelta","Math","abs","currentTarget","getContentSize","width","a_index","node_arr","i","length","b_index","a","b","a_node","b_node","runAction","moveTo","v2","tmp_name","random","min","max","floor"],"mappings":"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","file":"game.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        toplabel : {\r\n            default: null,\r\n            type: cc.Label\r\n        },\r\n        readybtn : {\r\n            default: null,\r\n            type: cc.Button\r\n        },        \r\n        card_jiandao:{\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        card_bu:{\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        card_shitou:{\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        jiandao:{\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        bu:{\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        shitou:{\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        countdown:{\r\n            default: null,\r\n            type: cc.Node\r\n        }\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad () {\r\n\r\n        this.lastrandom = 0;     \r\n        this.topready = this.bottomready = false;   \r\n        \r\n        this.top_grid = [\r\n            {x:-200,y:300,name:'card_jiandao'},\r\n            {x:0,y:300,name:'card_shitou'},\r\n            {x:200,y:300,name:'card_bu'},   \r\n        ];\r\n\r\n        this.bottom_grid = [\r\n            {x:-200,y:-300,name:'jiandao'},\r\n            {x:0,y:-300,name:'shitou'},\r\n            {x:200,y:-300,name:'bu'},  \r\n        ];   \r\n\r\n        this.schedule(function(){ this.swap(); },0.3,20,1);           \r\n        this.scheduleOnce(function(){ \r\n            this.toplabel.string = '已准备'; \r\n            this.topready = true;\r\n\r\n            this.node.emit('ready','top ready');\r\n        },8);\r\n\r\n        this.readybtn.node.on('click', function (event) {\r\n\r\n            this.readybtn.node.getChildByName('btn_text').getComponent(cc.Label).string = '已准备'; \r\n            this.bottomready = true;\r\n\r\n            this.node.emit('ready','bottom ready');\r\n        }, this);\r\n\r\n        this.node.on('ready', function (msg) {\r\n            console.log(this.topready);\r\n            console.log(this.bottomready);\r\n            if(this.topready && this.bottomready){\r\n                console.log(this.countdown);\r\n                var layout = this.node.getChildByName('Layout');\r\n                var amin = layout.getComponent(cc.Animation);\r\n                console.log(amin);\r\n                return ;\r\n                anim.play('countdown');\r\n            }\r\n        },this);\r\n\r\n        this.shitou.on(cc.Node.EventType.TOUCH_MOVE, this.onTouchMove, this);\r\n        this.bu.on(cc.Node.EventType.TOUCH_MOVE, this.onTouchMove, this);\r\n        this.jiandao.on(cc.Node.EventType.TOUCH_MOVE, this.onTouchMove, this);\r\n        this.shitou.on(cc.Node.EventType.TOUCH_END, this.onTouchEnd, this);\r\n        this.bu.on(cc.Node.EventType.TOUCH_END, this.onTouchEnd, this);\r\n        this.jiandao.on(cc.Node.EventType.TOUCH_END, this.onTouchEnd, this);\r\n        \r\n        \r\n        // var anim = this.card_shitou.getComponent(cc.Animation);\r\n        // anim.play('card_shitou');\r\n        \r\n        //anim.stop();\r\n    },\r\n\r\n    start () {\r\n        \r\n    },\r\n\r\n    onTouchMove : function(event) {\r\n        var delta = event.touch.getDelta();\r\n        if(Math.abs(event.currentTarget.x + delta.x)<=this.node.getChildByName('Layout').getContentSize().width/2){\r\n            event.currentTarget.x += delta.x;    \r\n        }   \r\n            \r\n    },\r\n\r\n    onTouchEnd : function(event){\r\n\r\n        var a_index = -1;\r\n        var node_arr = [];\r\n        for(var i=0;i<this.bottom_grid.length;i++){\r\n            if(this.bottom_grid[i].name==event.currentTarget.name){\r\n                a_index = i;\r\n            }\r\n            node_arr[i] = this.node.getChildByName('Layout').getChildByName(this.bottom_grid[i].name);\r\n        }\r\n\r\n        var b_index = a_index;\r\n        for(var i=0;i<node_arr.length;i++) {\r\n            if(i==a_index) continue;\r\n            console.log(node_arr[i].x+\"==\"+node_arr[a_index].x);\r\n\r\n            if(Math.abs(node_arr[i].x - node_arr[a_index].x)<100){\r\n                b_index = i;\r\n                break;\r\n            }          \r\n        }\r\n\r\n        console.log(a_index);\r\n        console.log(b_index);\r\n\r\n        var a = this.bottom_grid[a_index];      \r\n        var b = this.bottom_grid[b_index];      \r\n\r\n        var a_node = this.node.getChildByName('Layout').getChildByName(a.name);\r\n        var b_node = this.node.getChildByName('Layout').getChildByName(b.name);  \r\n\r\n        if(a_index==b_index) {\r\n            a_node.runAction(cc.moveTo(0.2, cc.v2(a.x,a.y)));\r\n            return ;\r\n        }\r\n\r\n        a_node.runAction(cc.moveTo(0.2, cc.v2(b.x,b.y)));\r\n        b_node.runAction(cc.moveTo(0.2, cc.v2(a.x,a.y)));\r\n\r\n        var tmp_name = this.bottom_grid[a_index].name;\r\n        this.bottom_grid[a_index].name = this.bottom_grid[b_index].name;\r\n        this.bottom_grid[b_index].name = tmp_name;\r\n    },\r\n\r\n    swap : function()\r\n    {\r\n        var swap = [\r\n            [0,1],\r\n            [0,2],\r\n            [1,2],\r\n        ];\r\n\r\n        var random = this.random(0,2);\r\n        while(random==this.lastrandom)\r\n        {\r\n            random = this.random(0,2);\r\n        }        \r\n        this.lastrandom = random;\r\n        \r\n        var a_index = swap[random][0];\r\n        var b_index = swap[random][1];\r\n\r\n        var a = this.top_grid[a_index];      \r\n        var b = this.top_grid[b_index];\r\n\r\n        var a_node = this.node.getChildByName('Layout').getChildByName(a.name);\r\n        var b_node = this.node.getChildByName('Layout').getChildByName(b.name);\r\n\r\n        a_node.runAction(cc.moveTo(0.2, cc.v2(b.x,b.y)));\r\n        b_node.runAction(cc.moveTo(0.2, cc.v2(a.x,a.y)));\r\n\r\n        var tmp_name = this.top_grid[a_index].name;\r\n        this.top_grid[a_index].name = this.top_grid[b_index].name;\r\n        this.top_grid[b_index].name = tmp_name;\r\n    },\r\n\r\n    random : function(min,max) {\r\n        return Math.floor(Math.random()*(max-min+1)+min);\r\n    },\r\n\r\n    // update (dt) {},\r\n});\r\n"]}